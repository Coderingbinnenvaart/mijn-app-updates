<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brughoogte Monitor Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0f172a;
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
            color: #f1f5f9;
            min-height: 100vh;
        }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
        }
        .status-ok { background: rgba(20, 184, 166, 0.2); color: #2dd4bf; border: 1px solid rgba(20, 184, 166, 0.3); }
        .status-warn { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.3); }
        .status-danger { background: rgba(239, 68, 68, 0.2); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); }
        
        input[type="number"] {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 0.5rem;
            outline: none;
            padding: 4px 8px;
        }
        input:focus { border-color: #38bdf8; }
        
        .marge-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            min-width: 90px;
            text-align: center;
        }
    </style>
</head>
<body class="py-12 px-4">

    <div class="max-w-7xl mx-auto mb-10 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-sky-500 rounded-xl flex items-center justify-center font-bold text-white shadow-lg shadow-sky-500/20">B</div>
            <h1 class="text-2xl font-black tracking-tight">BRUGHOGTE<span class="text-sky-500">MONITOR</span></h1>
        </div>
        <div class="glass-panel px-6 py-3 flex items-center gap-4">
            <span class="text-xs font-bold text-sky-400 uppercase">Scheepshoogte</span>
            <div class="flex items-center gap-2">
                <input type="number" id="global-ship-height" step="0.01" class="w-20 text-center font-bold text-lg">
                <span class="text-white/50 font-bold">m</span>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto space-y-12">
        
        <section>
            <div class="flex items-center gap-4 mb-6">
                <h2 class="text-xl font-extrabold tracking-wider text-white/90">DUITSLAND</h2>
                <div class="h-[1px] flex-grow bg-white/10"></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="glass-panel p-5">
                    <h3 class="text-[10px] font-bold text-sky-400 uppercase tracking-widest mb-4">Pegel (cm)</h3>
                    <div id="ws-list-de" class="space-y-3"></div>
                </div>
                <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4" id="br-list-de"></div>
            </div>
        </section>

        <section>
            <div class="flex items-center gap-4 mb-6">
                <h2 class="text-xl font-extrabold tracking-wider text-white/90">NEDERLAND</h2>
                <div class="h-[1px] flex-grow bg-white/10"></div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="glass-panel p-5">
                    <h3 class="text-[10px] font-bold text-sky-400 uppercase tracking-widest mb-4">Waterstand (cm)</h3>
                    <div id="ws-list-nl" class="space-y-3"></div>
                </div>
                <div class="lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4" id="br-list-nl"></div>
            </div>
        </section>

        <div id="alarm-container" class="max-w-2xl mx-auto"></div>

    </main>

    <script>
        // DATA
        const data = {
            de: {
                ws: [
                    { id: 'dus', name: 'Dusseldorf', val: 350, m1: 710, m2: 880 },
                    { id: 'rur', name: 'Ruhrort', val: 420, m1: 930, m2: 1130 },
                    { id: 'wes', name: 'Wesel', val: 380, m1: 870, m2: 1060 },
                    { id: 'emm', name: 'Emmerich', val: 310, m1: 700, m2: 870 }
                ],
                br: [
                    { id: 'neuss', name: 'Neuss-Hamm Br.', ref: 17.41, loc: 'dus' },
                    { id: 'knie', name: 'Kniebrucke (Duss.)', ref: 17.62, loc: 'dus' },
                    { id: 'krefeld', name: 'Krefeld', ref: 20.18, loc: 'rur' },
                    { id: 'vinc', name: 'Vincke kanaal', ref: 17.08, loc: 'rur' },
                    { id: 'ruhr', name: 'Ruhr', ref: 20.18, loc: 'rur' },
                    { id: 'wesel', name: 'Wesel', ref: 19.70, loc: 'wes' },
                    { id: 'rees', name: 'Rees', ref: 17.80, loc: 'emm' },
                    { id: 'emme', name: 'Emmerich', ref: 17.80, loc: 'emm' }
                ]
            },
            nl: {
                ws: [
                    { id: 'nij', name: 'Nijmegen', val: 650 },
                    { id: 'tiel', name: 'Tiel', val: 420 },
                    { id: 'zalt', name: 'Zaltbommel', val: 310 },
                    { id: 'wer', name: 'Werkendam', val: 150 },
                    { id: 'dor', name: 'Dordrecht', val: 110 },
                    { id: 'rot', name: 'Rotterdam', val: 80 },
                    { id: 'spijk', name: 'Spijkenisse', val: 90 },
                    { id: 'hoek', name: 'Hoek v. Holland', val: 50 }
                ],
                br: [
                    { id: 'waal', name: 'Nijmegen', ref: 22.80, loc: 'nij' },
                    { id: 'ewijk', name: 'Ewijk', ref: 23.20, loc: 'nij' },
                    { id: 'tielbr', name: 'Tiel', ref: 19.60, loc: 'tiel' },
                    { id: 'zaltb', name: 'Zaltbommel', ref: 17.40, loc: 'zalt' },
                    { id: 'gorin', name: 'Gorinchem', ref: 13.33, loc: 'wer' },
                    { id: 'baan', name: 'Baanhoek', ref: 12.90, loc: 'dor' },
                    { id: 'papen', name: 'Papendrecht', ref: 13.00, loc: 'dor' },
                    { id: 'dord', name: 'Dordrecht', ref: 11.35, loc: 'dor' },
                    { id: 'spijkb', name: 'Spijkenissebrug', ref: 12.50, loc: 'spijk' },
                    { id: 'botlek', name: 'Botlekbrug', ref: 14.00, loc: 'spijk' },
                    { id: 'hams', name: 'Hamsenbrug', ref: 11.45, loc: 'hoek' },
                    { id: 'suur', name: 'Suurhuffbrug', ref: 11.50, loc: 'hoek' },
                    { id: 'will', name: 'Willemsbrug', ref: 11.50, loc: 'rot' },
                    { id: 'eras', name: 'Erasmusbrug', ref: 12.50, loc: 'rot' }
                ]
            }
        };

        function saveAll() {
            const shipHeight = document.getElementById('global-ship-height').value;
            const values = {};
            document.querySelectorAll('input[data-ws-id]').forEach(input => {
                values[input.dataset.wsId] = input.value;
            });
            localStorage.setItem('monitor_shipHeight', shipHeight);
            localStorage.setItem('monitor_wsValues', JSON.stringify(values));
        }

        function loadAll() {
            const shipHeight = localStorage.getItem('monitor_shipHeight') || 4.00;
            const wsValues = JSON.parse(localStorage.getItem('monitor_wsValues') || '{}');
            
            document.getElementById('global-ship-height').value = shipHeight;
            
            // Update data objects with saved values
            [data.de.ws, data.nl.ws].flat().forEach(ws => {
                if(wsValues[ws.id]) ws.val = wsValues[ws.id];
            });
        }

        function render() {
            renderWSList(data.de.ws, 'ws-list-de');
            renderWSList(data.nl.ws, 'ws-list-nl');
            renderBRList(data.de.br, data.de.ws, 'br-list-de');
            renderBRList(data.nl.br, data.nl.ws, 'br-list-nl');
            updateCalculations();
        }

        function renderWSList(wsArray, targetId) {
            const container = document.getElementById(targetId);
            container.innerHTML = wsArray.map(ws => `
                <div class="flex items-center justify-between p-2 rounded-lg bg-white/5">
                    <span class="text-sm font-semibold">${ws.name}</span>
                    <input type="number" data-ws-id="${ws.id}" value="${ws.val}" 
                           class="w-16 text-right font-bold text-sky-400" 
                           oninput="updateVal('${ws.id}', this.value)">
                </div>
            `).join('');
        }

        function renderBRList(brArray, wsArray, targetId) {
            const container = document.getElementById(targetId);
            container.innerHTML = brArray.map(br => {
                const ws = wsArray.find(w => w.id === br.loc);
                return `
                    <div class="glass-panel p-4 flex items-center justify-between border-l-4 border-l-sky-500">
                        <div>
                            <h4 class="font-bold text-sm text-white">${br.name}</h4>
                            <p class="text-[9px] text-white/40 uppercase tracking-widest">${ws.name}</p>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                            <span id="dvh-${br.id}" class="text-xs font-mono text-white/60">--</span>
                            <div id="marge-${br.id}" class="marge-badge status-ok text-xs">--</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateVal(id, val) {
            [data.de.ws, data.nl.ws].flat().find(w => w.id === id).val = val;
            saveAll();
            updateCalculations();
        }

        function updateCalculations() {
            const shipHeight = parseFloat(document.getElementById('global-ship-height').value) || 0;
            const allBridges = [...data.de.br, ...data.nl.br];
            const allWS = [...data.de.ws, ...data.nl.ws];

            allBridges.forEach(br => {
                const ws = allWS.find(w => w.id === br.loc);
                const currentDvh = br.ref - (ws.val / 100);
                const marge = currentDvh - shipHeight;

                const dvhEl = document.getElementById(`dvh-${br.id}`);
                const margeEl = document.getElementById(`marge-${br.id}`);

                if(dvhEl) dvhEl.innerText = `DVH: ${currentDvh.toFixed(2)}m`;
                if(margeEl) {
                    margeEl.innerText = `${marge.toFixed(2)}m`;
                    margeEl.className = 'marge-badge ' + (marge < 0 ? 'status-danger' : marge < 0.5 ? 'status-warn' : 'status-ok');
                }
            });

            // Marke Alarms
            const alarms = [];
            data.de.ws.forEach(w => {
                if(w.val >= w.m2) alarms.push(`<div class="p-3 status-danger rounded-lg mb-2 font-bold text-center">üö® ${w.name.toUpperCase()}: MARKE II OVERSCHREDEN</div>`);
                else if(w.val >= w.m1) alarms.push(`<div class="p-3 status-warn rounded-lg mb-2 font-bold text-center">‚ö†Ô∏è ${w.name.toUpperCase()}: MARKE I OVERSCHREDEN</div>`);
            });
            document.getElementById('alarm-container').innerHTML = alarms.join('');
        }

        document.getElementById('global-ship-height').oninput = () => {
            saveAll();
            updateCalculations();
        };

        // Start
        loadAll();
        render();
    </script>
</body>
</html>
